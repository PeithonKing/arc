{% extends 'main/base.htm' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}{{ itr.short_name }}{% endblock %}
{% block l3h %}{{ itr }}{% endblock %}
{% block l5h %}{{ itr.inst }}{% endblock %}
{% block css %}<link rel="stylesheet" href="{% static 'main/css/itr.css' %}">{% endblock %}

{% block content %}	
  {% if item_list %}
    <ul class="list-group">
    {% for i in item_list %}
    <li class="list-group-item"><a href="{{ i.fl.url }}">{{ i.name }}</a></li>
    {% endfor %}
    </ul>
  {% else %}
    <p>Nothing.</p>
  {% endif %}	

  {% if user.is_authenticated %}
    <br>
    <button type="button" id="item-modal-btn" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#item-modal-inner">
      <span class="oi oi-plus"> </span>  Add
    </button>
    <br>

    
  {% endif %}
  <br>
  Discussions
  <br>

  {% if comm_list %}
    {% for c in comm_list %}
      <div id="comm-{{ c.id }}" class="comm alert alert-secondary" role="alert">

        <div class="container">
          <div class="row">
            <div class="col-md-6">
              <a href="{% url 'user' c.user.id %}">{{ c.user.name }}</a>
            </div>
            <div class="col-md">
              <span class="oi oi-clock"></span> {{ c.posted  }}
            </div>
            <div class="col-1">
              {% if user.is_authenticated %} 
                {% if user == c.user %}
                  <div class="del-container">
                    <button id="d_{{ c.id }}" type="button" class="btn btn-secondary btn-sm btn-delete" data-toggle="modal" data-target="#delete-modal-inner">
                      <span  class="oi oi-trash"></span>
                    </button>
                  </div>
                {% else %}
                  <div class="del-container">
                    <button id="r_{{ c.id }}" type="button" class="btn btn-secondary btn-sm btn-report" data-toggle="modal" data-target="#report-modal-inner">
                      <span class="oi oi-warning"></span>
                    </button>
                  </div>
                {% endif %}
              {% endif %}
            </div>
          </div>
        </div>
        <!--<hr class="comment-hr">-->
        <div class="markdown">{{ c.text }}</div>
      </div>
    {% endfor %}
  {% else %}
    No comments yet
  {% endif %}

  {% if user.is_authenticated %}
    {% if form.errors %}
      {% for field in form %}
        {% for error in field.errors %}
          <div class="alert alert-danger">
            <strong>{{ error|escape }}</strong>
          </div>
        {% endfor %}
      {% endfor %}

      {% for error in form.non_field_errors %}
        <div class="alert alert-danger">
          <strong>{{ error|escape }}</strong>
        </div>
      {% endfor %}
    {% endif %}

    <form method="post" action="{% url 'comment' itr.course.code itr.year itr.sem_name.lower %}">
      {% csrf_token %}
      {% for field in form %}
        <div class="form-group">
          <label for="{{ field.id_for_label }}">Add a new comment: </label>
          {{field|add_class:'form-control'}}
        </div>
      {% endfor %}
      <button type="submit" class="btn btn-primary">Post</button>
      <br>
      <br>
      <span>Preview</span>
      <div id="preview" class="alert alert-secondary" role="alert"></div>
    </form>

  {% endif %}

  {%if user.is_authenticated %}

  <!-- add-item modal -->
  <div id="item-modal">
    <div class="modal fade" id="item-modal-inner" role="dialog" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title" id="item-modal-header"> <span class="oi oi-plus"> </span> Add new content to {{ itr.short_name }} </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>

          <div class="modal-body" id="item-modal-body">
            <div class="modal-body-inner" id="item-modal-body-inner">
              <div class="container">
                <div class="text-center">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
            <br>
            <div id="item-progress" class="progress">
              <div id="item-progress-bar" class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>

          <div class="modal-footer" id="item-modal-footer">
          </div>

        </div>
      </div>
    </div>
  </div>
  <!-- end add-item modal -->

  <!-- report modal -->
  <div id="report-modal">
    <div class="modal fade" id="report-modal-inner" role="dialog" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title" id="report-modal-header"> <span class="oi oi-warning"></span> Report </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>

          <div class="modal-body" id="report-modal-body">
            <div id="report-modal-body-inner" class="container">

              <form id="comment-report-form" method="post" action="">
              {% csrf_token %}
              {% for field in report_form %}
                <div class="form-group">
                  <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                  {{field|add_class:'form-control'}}
                </div>
              {% endfor %}
                <button type="submit" class="btn btn-primary">Submit</button>
              </form>

            </div>
          </div>

          <div class="modal-footer" id="report-modal-footer">
          </div>

        </div>
      </div>
    </div>
  </div>
  <!-- end report modal -->

  <!-- delete modal -->
  <div id="delete-modal">
    <div class="modal fade" id="delete-modal-inner" role="dialog" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title" id="delete-modal-header"> <span class="oi oi-trash"></span> Delete comment </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>

          <div class="modal-body" id="delete-modal-body">
            <div id="delete-modal-msg" class="alert alert-danger">
              Are you sure you want to delete this comment?
            </div>
          </div>

          <div class="modal-footer" id="delete-modal-footer">
            <button id="del-yes" class="btn btn-danger"> Yes </button>
            <button id="del-no" class="btn btn-primary"> No </button>
          </div>

        </div>
      </div>
    </div>
  </div>
  <!-- end delete modal -->
  {% endif %}
{% endblock %}

{% block js %}
  <script type="text/javascript" src="{% static 'main/js/itr.js' %}"></script>
{% endblock %}
